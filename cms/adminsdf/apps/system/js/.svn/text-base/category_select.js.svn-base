(function(d){d.fn.category=function(){var h=d(this),g=h.next().next(),k=g.find(".cs_sb"),l=k.find("input"),i=h.next(),j=g.find(".cs_mitem"),c={scache:{},mcache:{},kcache:"",load:function(a){d(this).css("visibility","hidden");var b=d(this).position();g.show().css({left:b.left,top:b.top-4});d.getJSON("?app=system&controller=category&action=dropcate",{},function(e){if(e){c._binditem(e,false);c.mcache=e}});l.focus();a.stopPropagation()},search:function(a){if(!(a.keyCode==38||a.keyCode==40||a.keyCode==
13))if(a.keyCode==37||a.keyCode==39)c.select(d(".over"));else{var b=this.value;if(c.kcache=b)c.scache[b]==undefined?d.getJSON("?app=system&controller=category&action=search",{keyword:b},function(e){c._binditem(e,true);c.scache[b]=e}):c._binditem(c.scache[b],true);else c.mcache[0]&&c._binditem(c.mcache,false);return false}},hotkey:function(a){var b=d(".over");if(a.keyCode==38||a.keyCode==40)if(b[0]==undefined)d(".cs_mlist:first").addClass("over");else{b.removeClass("over");var e=b.prev()[0]?b.prev():
d(".cs_mlist:last");b=b.next()[0]?b.next():d(".cs_mlist:first");a.keyCode==40&&b.addClass("over");a.keyCode==38&&e.addClass("over")}a.keyCode==13&&c.select(d(".over"));a.stopPropagation()},select:function(a){a=a[0]?a:d(this);if(a[0]!=document){h.val(a.attr("catid"));i.html(a.attr("name"));d.get("?app=system&controller=category&action=note",{catid:h.val(),name:a.attr("name")})}g.hide();j.html("");i.css("visibility","visible")},_binditem:function(a,b){j.html("");for(var e="",m=a.length,f=0;f<m;f++){if(b)e=
a[f].name.replace(c.kcache,"<b>"+c.kcache+"</b>");j.append(d('<div class="cs_mlist '+(f==0&&b?"over":"")+'" catid="'+a[f].catid+'" name="'+a[f].name+'" >'+(b?e:a[f].name)+"</div>").hover(function(){d(this).addClass("over")},function(){d(this).removeClass("over")}).bind("click",c.select))}}};d(document).click(c.select);i.click(c.load);k.click(function(a){a.stopPropagation()});l.keyup(c.search);g.keydown(c.hotkey)}})(jQuery);
